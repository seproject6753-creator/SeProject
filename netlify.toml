## Netlify build configuration for the React frontend
## Docs: https://docs.netlify.com/configure-builds/file-based-configuration/

[build]
	# Run from the frontend directory and build there
	base = "frontend"
	command = "npm ci && npm run build"
	# When base is set, publish is relative to base
	publish = "build"

[build.environment]
	# Ensure a modern Node for CRA 5
	NODE_VERSION = "18"
	# Extra heap to avoid OOM on larger builds
	NODE_OPTIONS = "--max_old_space_size=4096"
	# Prevent CRA from failing the build on warnings in CI
	CI = "false"
	# (Optional) Completely disable CRA ESLint plugin during build so warnings never block deploy
	DISABLE_ESLINT_PLUGIN = "true"
	# Set these in Netlify UI (recommended) or uncomment and commit to hardcode
	# REACT_APP_APILINK = "https://<your-render-app>.onrender.com/api"
	# REACT_APP_MEDIA_LINK = "https://<your-render-app>.onrender.com/media"

## SPA fallback so React Router deep links work on refresh
[[redirects]]
	from = "/*"
	to = "/index.html"
	status = 200

## Proxy API and media calls to Render backend
[[redirects]]
	from = "/api/*"
	to = "https://seproject-1-skjz.onrender.com/api/:splat"
	status = 200
	force = true

[[redirects]]
	from = "/media/*"
	to = "https://seproject-1-skjz.onrender.com/media/:splat"
	status = 200
	force = true

## Special auth route to avoid ad blockers on '/login'
[[redirects]]
	from = "/xapi/:role/auth"
	to = "https://seproject-1-skjz.onrender.com/api/:role/login"
	status = 200
	force = true

